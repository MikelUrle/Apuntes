!Variables

Pers num PiezasEntrada := 4;
Pers num PiezasSalida := 0;
Pers num PiezasEntradaMecanizado := 0;
Pers num PiezasSalidaMecanizado := 6;

PROC main()

    !Esto es un ciclo donde vemos la cantidad de piezas que tiene el centro de mecanizado y la cinta de salida
    !Si en centro de mecanizado esta cerrado por tener las 6 piezas y la cinta de salida ya se ha movido con las 4 piezas
    !El ciclo se cierra

    If CentroMecanizado = Cerrado and PiezasSalida = 0 then

        Stop;

    Else

        rtCiclo;

    Endif

ENDPROC


PROC rtCiclo()

    !Llamamos al palet y esperamos a que llegue a su posicion en la cinta de entrada

    rtMoverPaletEntrada;
    WaitUntil Palet;

    !Sabiendo que tenemos dos pinzas, podremos coger dos piezas a la vez y dejarlas en el centro de mecanizado

    Esperar permiso a recoger las piezas;
    Mover robot a posicion

    rtCogerPiezaCabeza1;
    rtCogerPiezaCabeza2; 

    Esperar permiso para dejar piezas
    Mover robot para dejar las piezas

    rtDejarPiezaEnMecanizadoCabeza1;
    rtDejarPiezaEnMecanizadoCabeza2;
    
    !Con esto tendremos que cambiar los valores a las variables para saber cuantas piezas tenemos y donde

    PiezasEntrada = PiezasEntrada - 2;

    If CentroMecanizado = Abierto then

        PiezasEntradaMecanizado = PiezasEntradaMecanizado + 2;

    Else

        PiezasSalida = PiezasSalida + 2;

    Endif

    !Llamaremos a la funcion para validar la cantidad de piezas que hay en cada lugar
    validarCantidadPiezas();


ENDPROC

 
PROC validarCantidadPiezas()

    !Cada vez que hagamos un movimiento, tenemos que validar si seguimos teniendo piezas en el palet, o si el centro de mecanizado le quedan piezas o si ya se tiene las suficientes

    If PiezasEntrada = 0 then

    !Tendremos que volver a llamar a la cinta de entrada para que traiga otro palet
    !Mientras seguimos haciendo movimiento y no tendremos que esperar a que llegue el palet

    rtMoverPaletEntrada;
    !Volvemos a tener 4 piezas en la cinta de entrada
    PiezasEntrada = 4;

    Endif

    !Ahora con el centro de mecanizado, primero las piezas que hay que dejar

    If PiezasEntradaMecanizado = 6 then

    !Si tiene las 6 piezas necesarias, le decimos al robot que esta cerrado y que no puede dejar mas piezas
    !Tambien hay que decirle que tiene que empezar a dejar las piezas en la cinta de salida y no en el de mecanizado

    rtCerrarEntradaMecanizado;
    rtDejarPiezasEn(CintaDeSalida);

    Endif

    !Despues las piezas que hay que mover del centro de mecanizado
    !Asi dejando el unico sitio donde se podran recoger piezas, la cinta de entrada

    If PiezasSalidaMecanizado = 0 then

    rtCerrarSalidaMecanizado;

    Endif

    !Por ultimo para saber si la cinta de salida esta llena

    If PiezasSalida = 4 then

    rtMoverPaletSalida;
    !Volveremos a tener 4 espacios para piezas vacios
    PiezasSalida = 0;

    Endif

ENDPROC